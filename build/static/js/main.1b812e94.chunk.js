(this["webpackJsonpspace-invaders"]=this["webpackJsonpspace-invaders"]||[]).push([[0],{18:function(e,t,n){e.exports=n(43)},23:function(e,t,n){},41:function(e,t,n){e.exports=n.p+"static/media/photon-torpedos.9a96bd66.mp3"},42:function(e,t,n){e.exports=n.p+"static/media/invader-death.b68af747.mp3"},43:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(4),c=n.n(o),s=(n(23),n(6)),i={MOVEMENT:{UP:"w",DOWN:"s",LEFT:"a",RIGHT:"d"},WEAPONS:{PHOTON_TORPEDOS:" "}},l=function(e){var t=a.a.useRef(),n=a.a.useRef(),o=a.a.useRef();return Object(r.useEffect)((function(){n.current=e})),Object(r.useEffect)((function(){var e=t.current;if(e.getContext){var r;return function t(a){r=window.requestAnimationFrame(t),function(){var t=e.getContext("2d");t.clearRect(0,0,e.width,e.height);var r=n.current.player.geo,a=r.pos,o=r.width,c=r.height;t.save(),t.translate(a.x,a.y),t.lineWidth=6,t.strokeStyle="gray",t.lineCap="round",t.beginPath(),t.moveTo(0,0),t.lineTo(0,c),t.moveTo(o,0),t.lineTo(o,c),t.stroke();var s=o/2,i=c/2;t.fillStyle="gray",t.beginPath(),t.ellipse(s,i,o/2,c/2,0,0,2*Math.PI),t.strokeStyle="black",t.lineWidth=1,t.fill(),t.stroke();var l=t.createLinearGradient(s,i-c/2,s,i+c/2);l.addColorStop(0,"white"),l.addColorStop(1,"gray"),t.fillStyle=l,t.beginPath(),t.ellipse(s,i,o/4.8,c/4,0,0,2*Math.PI),t.fill(),t.restore(),n.current.shots.forEach((function(e){var n=e.geo.pos,r=n.x,a=n.y,o=e.geo,c=o.width,s=o.height;t.save(),t.translate(r,a),t.lineWidth=3,t.strokeStyle="purple",t.fillStyle="violet",t.beginPath(),t.ellipse(c/2,s/2,c/2,s/2,0,0,2*Math.PI),t.fill(),t.stroke(),t.restore()})),n.current.invaders.forEach((function(e){var n=e.geo.pos,r=n.x,a=n.y,o=e.geo,c=o.width,s=o.height;t.save(),t.translate(r,a),t.fillStyle="gray",t.beginPath(),t.ellipse(c/2,s/2,c/2,s/2,0,0,2*Math.PI),t.fill(),t.restore()}))}(),o.current=a}(0),function(){window.cancelAnimationFrame(r)}}}),[]),a.a.createElement("div",{className:"graph-container"},a.a.createElement("canvas",{ref:t,style:{margin:"0 auto",display:"block"},width:1024,height:600},"This browser is not supported."))},u=n(17),p=n(1),d=function(e,t){return t.geo.pos.x-e.geo.pos.x<=e.geo.width&&t.geo.pos.x-e.geo.pos.x>=-10&&t.geo.pos.y-e.geo.pos.y<=e.geo.height&&t.geo.pos.y-e.geo.pos.y>=-(15-e.geo.height+1.5)},y=function(e){return e.invaders.map((function(e){return e.geo})).some((function(t){return n=e.player.geo,(r=t).pos.x-n.pos.x<=n.width&&r.pos.x-n.pos.x>=-r.width&&r.pos.y-n.pos.y<=n.height&&r.pos.y-n.pos.y>=-r.height;var n,r}))},f={isStarted:!1,score:0,player:{geo:{width:75,height:75,pos:{x:409.6,y:480}},cooldown:0},shots:[],invaders:[]},h=function(e,t){var n=function(t){return t.hp>0&&function(t){return e.shots.some((function(e){return d(t,e)}))}(t)?t.hp-1:t.hp},r=e.invaders.filter((function(e){return e.geo.pos.y+e.geo.height<600})).filter((function(e){return e.hp>0})).map((function(e){return Object(p.a)({},e,{geo:Object(p.a)({},e.geo,{pos:Object(p.a)({},e.geo.pos,{y:n(e)>0?e.geo.pos.y+1.5:e.geo.pos.y})}),hp:n(e)})}));return Object(p.a)({},e,{player:Object(p.a)({},e.player,{cooldown:e.player.cooldown-1}),score:e.score+r.reduce((function(e,t){return e+(0===t.hp?t.score:0)}),0),shots:e.shots.filter((function(e){return e.geo.pos.y>0})).filter((function(t){return n=t,!e.invaders.some((function(e){return d(e,n)}));var n})).map((function(e){return Object(p.a)({},e,{geo:Object(p.a)({},e.geo,{pos:Object(p.a)({},e.geo.pos,{y:e.geo.pos.y-15})})})})),invaders:r})},m=function(e,t){if("START"===t.type)return Object(p.a)({},e,{isStarted:!0});if("NEW_GAME"===t.type)return Object(p.a)({},f,{isStarted:!0});if(!1===e.isStarted)return e;if(y(e))return e;switch(t.type){case"MOVE":return function(e,t){var n,r,a,o=e.player,c=Object(p.a)({},o.geo,{pos:Object(p.a)({},o.geo.pos,{x:e.player.geo.pos.x+t.payload.dx,y:e.player.geo.pos.y+t.payload.dy})});return r=1024,a=600,(n=c).pos.y+n.height<a&&n.pos.y>0&&n.pos.x+n.width<r&&n.pos.x>0?Object(p.a)({},e,{player:Object(p.a)({},e.player,{geo:c})}):e}(e,t);case"FIRE":return function(e,t){return Object(p.a)({},e,{player:Object(p.a)({},e.player,{cooldown:e.player.cooldown<0?1e3/45:e.player.cooldown}),shots:e.player.cooldown<0?[].concat(Object(u.a)(e.shots),[{geo:{pos:{x:e.player.geo.pos.x+e.player.geo.width/2-5,y:e.player.geo.pos.y},width:10,height:10}}]):e.shots})}(e);case"TICK":return h(e);case"ADD_INVADER":return function(e,t){return Object(p.a)({},e,{invaders:e.invaders.concat(t.payload)})}(e,t);default:return f}},g=a.a.forwardRef((function(e,t){var n=a.a.useRef();return Object(r.useImperativeHandle)(t,(function(){return{play:function(){n.current.currentTime=0,n.current.play()}}})),a.a.createElement("audio",{ref:n,src:e.audio})})),E=function(e){return a.a.createElement("table",{style:{width:"100%"}},a.a.createElement("thead",null,a.a.createElement("tr",null,a.a.createElement("th",{colSpan:2},e.title))),a.a.createElement("tbody",null,e.rows.map((function(e){return a.a.createElement("tr",{key:e.key},a.a.createElement("td",{style:{textAlign:"left"}},e.left),a.a.createElement("td",{style:{textAlign:"right"}},e.right))}))))},v=function(e){return a.a.createElement(E,{title:"Controls",rows:e.keys.map((function(e){return{key:e.key,left:a.a.createElement("span",{className:"movement-key"},e.key),right:e.description}}))})},O=function(e){var t=e.handleStart;return a.a.createElement("div",{className:"screen start-screen"},a.a.createElement("section",{className:"panel panel-start"},a.a.createElement(v,{keys:[{key:"W",description:"Move up"},{key:"S",description:"Move down"},{key:"A",description:"Move left"},{key:"D",description:"Move right"},{key:"Spacebar",description:"Fire photon torpedos"}]}),a.a.createElement("button",{style:{marginTop:"3em"},onClick:t},"Start")))},b=function(e){return a.a.createElement(a.a.Fragment,null,a.a.createElement("h1",null,"High Scores"),a.a.createElement("div",{className:"high-scores-container"},a.a.createElement(E,{rows:e.scores.map((function(e,t){return{key:e.username,left:"".concat(t+1,". ").concat(e.username),right:a.a.createElement("span",{className:"score"},e.score)}}))})))},w=function(e){return a.a.createElement("div",{className:"screen end-screen"},a.a.createElement("section",{className:"panel panel-end"},a.a.createElement("h1",null,"Game Over"),a.a.createElement("h2",null,"Your score: ",e.playerScore),a.a.createElement("section",{className:"buttons"},a.a.createElement("button",{onClick:e.handleNewGame},"New Game"),a.a.createElement("button",null,"Save")),a.a.createElement(b,{scores:e.scores})))},k=n(16),j=n.n(k),x={photonTorpedos:n(41),invaderDeath:n(42)},S=Object.values(i).reduce((function(e,t){return Object.values(e).concat(Object.values(t))}),[]),T={},M=function(){var e=Object(r.useState)([]),t=Object(s.a)(e,2),n=t[0],o=t[1],u=Object(r.useReducer)(m,f),p=Object(s.a)(u,2),d=p[0],h=p[1],E={invaderDeath:a.a.useRef(),photonTorpedos:a.a.useRef()};return Object(r.useEffect)((function(){y(d)&&0===n.length&&j.a.get("/api/users").then((function(e){o(e.data)})).catch((function(e){console.log("GET request failed.")}))})),Object(r.useEffect)((function(){var e=function(e){-1!==S.indexOf(e.key)&&(T[e.key]=!1)},t=function(e){-1!==S.indexOf(e.key)&&(T[e.key]=!0)};return window.addEventListener("keydown",t),window.addEventListener("keyup",e),function(){window.removeEventListener("keydown",t),window.removeEventListener("keyup",e)}}),[]),Object(r.useEffect)((function(){var e=function(){h({type:"TICK",payload:{}}),T[i.MOVEMENT.UP]&&h({type:"MOVE",payload:{dx:0,dy:-6}}),T[i.MOVEMENT.DOWN]&&h({type:"MOVE",payload:{dx:0,dy:6}}),T[i.MOVEMENT.LEFT]&&h({type:"MOVE",payload:{dx:-6,dy:0}}),T[i.MOVEMENT.RIGHT]&&h({type:"MOVE",payload:{dx:6,dy:0}}),T[i.WEAPONS.PHOTON_TORPEDOS]&&h({type:"FIRE",payload:{}}),Math.random()<.05&&h({type:"ADD_INVADER",payload:function(){var e,t;return{geo:{pos:{x:(e=10,t=1014,Math.random()*(t-e)+e),y:0},width:20,height:20},hp:1,score:1}}()})},t=setInterval((function(){return c.a.unstable_batchedUpdates(e)}),15);return function(){return clearInterval(t)}}),[]),Object(r.useEffect)((function(){d.player.cooldown===1e3/45&&E.photonTorpedos.current.play(),d.invaders.forEach((function(e){e.hp<=0&&E.invaderDeath.current.play()})),y(d)&&E.invaderDeath.current.play()})),a.a.createElement("div",null,Object.keys(x).map((function(e){return a.a.createElement(g,{key:e,ref:E[e],audio:x[e]})})),!1===d.isStarted?a.a.createElement(O,{handleStart:function(){return h({type:"START",payload:{}})}}):y(d)?a.a.createElement(w,{handleNewGame:function(){return h({type:"NEW_GAME",payload:{}})},handleSave:function(){return 0},playerScore:d.score,scores:n}):a.a.createElement(l,d))};c.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(M,null)),document.getElementById("root"))}},[[18,1,2]]]);
//# sourceMappingURL=main.1b812e94.chunk.js.map